% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/create_NAM.R
\name{association_nam}
\alias{association_nam}
\title{Neighborhood Abundance Map (NAM) Association Test}
\usage{
association_nam(
  seurat_object = NULL,
  metadata = NULL,
  pcs = NULL,
  test_var = NULL,
  samplem_key = NULL,
  graph_use = "RNA_snn",
  batches = NULL,
  covs = NULL,
  nsteps = NULL,
  verbose = TRUE,
  assay = NULL,
  key = "NAMPC_",
  maxnsteps = 15L,
  max_frac_pcs = 0.15,
  ks = NULL,
  Nnull = 1000,
  force_permute_all = FALSE,
  local_test = TRUE,
  seed = 1234,
  return_nam = TRUE
)
}
\arguments{
\item{seurat_object}{A Seurat object containing the single-cell data and pre-computed graph.}

\item{metadata}{Optional. A data frame with cell metadata, used if `seurat_object` is NULL.}

\item{pcs}{Optional. A matrix of pre-computed principal components, used if `seurat_object` is NULL.}

\item{test_var}{The name of the numeric variable in sample-level metadata to test for association.}

\item{samplem_key}{The column name in the metadata that identifies unique samples or individuals.}

\item{graph_use}{The name of the graph to use from the Seurat object (e.g., 'RNA_snn').}

\item{batches}{Optional. The column name(s) for batch variables, used for conditional permutation.}

\item{covs}{Optional. The column name(s) for other covariates to regress out from the NAM.}

\item{nsteps}{Optional. The number of diffusion steps. If NULL, it is determined automatically.}

\item{verbose}{Logical. If TRUE, print progress messages.}

\item{assay}{The assay to store the results in.}

\item{key}{The key for the new DimReduc object.}

\item{maxnsteps}{The maximum number of diffusion steps allowed when `nsteps` is NULL.}

\item{max_frac_pcs}{The maximum fraction of samples to use as the number of NAM PCs.}

\item{ks}{A numeric vector specifying the number of PCs to test for the association model. If NULL, this is determined automatically.}

\item{Nnull}{The number of permutations to generate for the null distribution.}

\item{force_permute_all}{Logical. If TRUE, ignore batches and permute across all samples.}

\item{local_test}{Logical. If TRUE, computes neighborhood-level FDRs to identify specific significant neighborhoods.}

\item{seed}{An integer for setting the random seed for reproducibility.}

\item{return_nam}{Logical. If TRUE, stores the NAM embeddings and loadings in the result.}
}
\value{
A Seurat object with a new `DimReduc` object (default key 'cna') containing the NAM results.
The `misc` slot of this object holds the detailed association test statistics. New metadata columns with
neighborhood correlations (ncorrs) are also added.
}
\description{
Performs an association test between a sample-level variable and cell state abundance,
as captured by a Neighborhood Abundance Map (NAM). The method involves diffusing
sample information across a cell-cell graph, performing dimensionality reduction on the
resulting NAM, and then using a permutation-based approach to test for significant
associations between the principal components of the NAM and the variable of interest.
}
